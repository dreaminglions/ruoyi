<!DOCTYPE html>
<html  lang="en" xmlns:th="http://www.thymeleaf.org">
<head>

    <script th:src="@{/water/view01/js/layer/layer.min.js}"></script>
    <link th:href="@{/water/view02/css/BigData.css}" rel="stylesheet" type="text/css" />
    <link th:href="@{/water/view02/css/index.css}" rel="stylesheet" type="text/css" />
    <link th:href="@{/water/view02/css/index01.css}" rel="stylesheet" type="text/css" />
    <script th:src="@{/water/view02/js/jquery.js}"></script>
    <link th:href="@{/water/view02/js/bstable/css/bootstrap.min.css}" rel="stylesheet" type="text/css" />
    <link th:href="@{/water/view02/js/bstable/css/bootstrap-table.css}" rel="stylesheet" type="text/css" />
    <link th:href="@{/water/view02/css/Security_operation.css}" rel="stylesheet" type="text/css" />
    <link th:href="@{/water/view02/js/artDialog/skins/default.css}" rel="stylesheet" type="text/css"/>
    <script th:src="@{/water/view02/js/laydate.js}"></script>
    <script th:src="@{/water/view02/js/Home_page.js}"></script>

    <script language="javascript" th:src="@{/water/view02/jqprint/jquery-1.4.4.min.js}"></script>
    <script language="javascript" th:src="@{/water/view02/jqprint/jquery.jqprint-0.3.js}"></script>


    <meta charset="UTF-8">
    <title>大数据管理平台</title>

</head>
<body id="aaa">
<div class="data_bodey">


    <div class="index_top" style="margin: 0 auto;">
         <a class="back-png" >
            <!--<img id="weatherImg1" th:src="@{/water/view01/images/back.png}" alt="" height="40" width="40" onclick="click1()">-->
            <img id="weatherImg2" th:src="@{/water/view01/images/Home.png}" alt="" height="40" width="40" onclick="click2()">
            <!--<img id="weatherImg3" th:src="@{/water/view01/images/back2.png}" alt="" height="40" width="40" onclick="click3()">-->
        </a>
        <div style="height: 50%; margin-bottom: 0px;">
            <div class="data_tit001">大数据分析系统</div>
        </div>

        <div style="height: 40%; margin-bottom: 0px;margin-top:10px">
            <span class="chose_tltle">请选择现场：</span>

            <select id="waterValue"  class="water_chose"  th:with="type=${@bizWorks.getOnlyWorks()}" onchange="changewaterid()" >
                <option class="water_option" value="">请选择</option>
                <option class="water_option" th:each="bizWorks : ${type}" th:text="${bizWorks.worksName}" th:value="${bizWorks.worksId}"></option>

            </select>

            <span class="chose_tltle">请选择化验日期：</span>
            <input class="time_chose" type="text"  id="startTime" >

            <span class="chose_tltle" id="NoValue_span" style="display:none">请选择化验编号：</span>
            <select class="water_chose" id="NoValue"  style="display:none"></select>

            <button id="btn_sw" class="chose_enter" style="width: 100px; display:none" onclick="chage_water()">查询化验信息</button>
            <button id="btn_sn" class="chose_enter" style="width: 100px;" onclick="select_no()" >查询化验单号</button>

        </div>
        <div class="clear"></div>
    </div>


    <div class="index_tabs" >
        <div class="inner">

            <div class="data_left02" >
                <div class="dataAll01">
                    <div class="dataAllBorder01">
                        <div class="dataAllBorder02">
                            <div class="data_tit2">化验状态信息</div>

                            <div style="height:25%;">
                                <table class="table_data01">
                                    <tr ><td class="font07">当前化验状态</td><td colspan="2"class="font04" id="valrt_1"></td></tr>
                                    <tr ><td class="font6">当前化验节点：</td><td class="font04" id="valrt_2"></td><td class="font04" id="valrt_3"></td></tr>
                                    <tr ><td class="font6">当前告警状态：</td><td colspan="2"class="font03" id="valrt_4"></td></tr>
                                    <tr ><td class="font6">当前故障状态：</td><td colspan="2"class="font04" id="valrt_5"></td></tr>
                                </table>
                            </div>

                            <div class="data_tit3" style="margin-top:1%">化验告警故障 </div>

                            <!--<div style="width: 90%;height:30%;position: relative;margin: 0 auto;">-->
                                <!--<div class="message-box" >-->
                                    <!--<div id="p1" class="scrollNews">-->
                                    <!--</div>-->
                                <!--</div>-->
                            <!--</div>-->

                            <!--<div class="data_tit3" style="margin-top:1%">化验故障 </div>-->

                            <div style="width: 90%;height:45%;position: relative;margin: 0 auto;">
                                <div class="message-box" >
                                    <div class="scrollNews ">

                                        <ul id="p2" class="faultNews"></ul>
                                        <!--<div id="p2" class="faultNews">-->
                                        <!--</div>-->
                                    </div>

                                </div>
                            </div>

                            <div style="width: 90%;height:5%;position: relative;margin: 0 auto;text-align:center;">
                                <button class="relieve_enter" style="vertical-align:middle;" onclick="relieve_alert()">解除故障告警</button>
                            </div>


                        </div>
                    </div>
                </div>

            </div>

            <div class="data_left03">
                <!--style="margin-top: 6.3%"-->
                <div class="dataAllNo01_01">
                    <div class="dataAllBorder01">
                        <div class="dataAllBorder02">

                            <div class="data_tit3">化验单据信息</div>
                            <div style="height:15%">
                                <table class="table_data01">
                                    <tr onclick=" Print()"><td class="font07">化验单据编号：</td><td colspan="3"class="font03" id="val01"></td></tr>
                                    <tr ><td class="font6">化验设备：</td><td class="font01" id="val02"></td><td class="font6">化验人：</td><td class="font01" id="val03"></td></tr>
                                </table>
                            </div>
                            <div class="data_tit3" style="margin-top:2%">化验参数对比 </div>

                            <div style="height:27%">
                                <table class="table_data01">
                                    <tr>
                                        <td></td><td class="font04">COD</td><td class="font04">NH3</td><td class="font04">TP</td><td class="font04">TN</td>
                                    </tr>
                                    <!-- <tr><td>范围值</td><td class="font6" id="tval01">10</td><td class="font6" id="tval02">6</td><td class="font6" id="tval03">15</td><td class="font6" id="tval04">5</td></tr> -->
                                    <tr><td>入水</td><td class="font08" id="tval05"></td><td class="font08" id="tval06"></td><td class="font08" id="tval07"></td><td class="font08" id="tval08"></td></tr>
                                    <tr><td>出水</td><td class="font6" id="tval09"></td><td class="font6" id="tval10"></td><td class="font6" id="tval11"></td><td class="font6" id="tval12"></td></tr>
                                </table>
                            </div>

                            <div style="height:6%"></div>
                            <div style="height:10%">
                                <span class="chose_tltle">请选择化验曲线：</span>
                                <select class="time_chose" id="curveValue" onchange="chage_curve(this.value)" style="width: 140px;">
                                    <option value="0" class="water_option" >请选择</option>
                                    <option value="1" class="water_option" selected>入水COD曲线参数</option>
                                    <option value="2" class="water_option" >出水COD曲线参数</option>
                                    <option value="3" class="water_option" >NH3曲线参数</option>
                                    <option value="4" class="water_option" >TP曲线参数</option>
                                    <option value="5" class="water_option" >TN曲线参数</option>
                                </select>

                            </div>




                            <img id="printImg1" style="width:100%;">
                            <div style="height:15%">
                                <table class="table_data01" id="curve_table" >
                                    <tr>
                                        <td class="font04" id="wave1_name">入水COD波长1</td><td class="font04" id="wave2_name">入水COD波长2	</td><td class="font04" id="k_name">入水COD曲线k</td><td class="font04" id="b_name">入水COD曲线B</td>
                                    </tr>
                                    <td class="font6" id="wave1"></td><td class="font6" id="wave2"></td><td class="font6" id="curve_k"></td><td class="font6" id="curve_b"></td></tr>
                                </table>
                                <!--<p class="zhanleft02" id="allAly03"></p>-->
                            </div>

                        </div>
                    </div>
                </div>
            </div>

            <div class="data_left04">
                <div class="dataAll">
                    <div class="dataAllBorder01">
                        <div class="dataAllBorder02">
                            <div class="data_tit1">设备工作累计</div>
                            <p class="data_chart" id="actionBook"></p>
                        </div>
                    </div>
                </div>

                <div class="dataAll">
                    <div class="dataAllBorder01">
                        <div class="dataAllBorder02">
                            <div class="data_tit1">化验项目情况</div>
                            <p class="data_chart" id="bookBmonth"></p>
                        </div>
                    </div>
                </div>
                <div class="dataAll">
                    <div class="dataAllBorder01">
                        <div class="dataAllBorder02">
                            <div class="data_tit1">废液情况</div>
                            <p class="data_chart" id="whearAbook"></p>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<script th:src="@{/water/view02/js/echarts-all.js}"></script>
<!-- <script src="js/index.js"></script> -->
<script th:src="@{/water/view02/js/bstable/js/bootstrap.min.js}"></script>
<script th:src="@{/water/view02/js/bstable/js/bootstrap-table.js}"></script>
<script th:src="@{/water/view02/js/jquery.pagination.js}"></script>
<script th:src="@{/water/view02/js/bstable/js/bootstrap-table-zh-CN.min.js}"></script>
<script th:src="@{/water/view02/js/Home_page.js}"></script>
<script th:src="@{/water/view02/js/artDialog/artDialog.js}"></script>
<script th:src="@{/water/view02/js/artDialog/plugins/iframeTools.source.js}"></script>

<script th:inline="javascript">
    var number;
    $(function() {
        if (window.screen.height <= 768) {
            number = 4;
        } else if (window.screen.height > 768 && window.screen.height <= 900) {
            number = 6
        } else if (window.screen.height > 1080) {
            number = 8
        }
    });


    //    翻页模块
    $(".tcdPageCode").createPage({
        pageCount:5,
        current:1,
        backFn:function(p){}
    });
    $(".chemistry_tcdPageCode").createPage({
        pageCount:4,
        current:1,
        backFn:function(p){}
    });
    $(".enterprise_tcdPageCode").createPage({
        pageCount:4,
        current:1,
        backFn:function(p){}
    });
    $(".car_tcdPageCode").createPage({
        pageCount:4,
        current:1,
        backFn:function(p){}
    });

    $(function () {
        $(".tit02Diva a").each(function (index) {
            $(this).on("click",function () {
                $(".data_map").eq(index).fadeIn().siblings(".data_map").stop().hide();
                $(this).prev('i').removeClass('i_crlieAction');
                $(this).siblings('a').prev('i').addClass('i_crlieAction');

            })
        });
        BootstrapTable();
        // Echarts();
        $("#fresh_tool").click(function(event){
            event.stopPropagation();
            cancel();
        })

    });
    function EventClick(){
        $(".check_increase").removeClass("check_increase_act");
        $("#over_hide1").show().siblings().hide();
        $(".check_decrease").show();
        $("#cage_cl").hide();
        $("#map_title_innerbox").hide();
        $("#cage_cl1").show();
//        $("#over_hide").show();
        $("#map_title_innerbox1").show();
        $(".addition_check_in").hide();
        $("#car_check_in").hide();
        BootstrapTable();
    }
    function cancel(e){
        $(".check_increase").removeClass("check_increase_act");
        $("#over_hide").show().siblings().hide();
        $(".check_decrease").show();
        $("#cage_cl").show();
        $("#cage_cl1").hide();
//        $("#cage_cl").show();
//        $("#over_hide1").show();
//        $("#map_title_innerbox").show();
        BootstrapTable();
    }

    //    地址检索
    $(".addition_check_btn").click(function () {
        $(".check_increase").addClass("check_increase_act");
        $(".check_decrease").hide()
        $(".addition_check_in").show().siblings().hide()
    });

    //    危化品检索
    function chemistryCheck() {
        $(".check_increase").addClass("check_increase_act");
        $(".check_decrease").hide()
        $("#chemistry_check_in").show().siblings().hide()
    }

    //    企业检索
    function enterpriseCheck() {
        $(".check_increase").addClass("check_increase_act");
        $(".check_decrease").hide()
        $("#enterprise_check_in").show().siblings().hide()
    }

    //    车辆检索
    function carCheck() {
        $(".check_increase").addClass("check_increase_act");
        $(".check_decrease").hide()
        $("#car_check_in").show().siblings().hide()
    }

    function BootstrapTable() {
        $('#table').bootstrapTable({
            method: "get",
            striped: true,
            singleSelect: false,
            url: "json/DGCar.json",
            dataType: "json",
            pagination: true, //分页
            pageSize: number,
            pageNumber: 1,
            search: false, //显示搜索框
            contentType: "application/x-www-form-urlencoded",
            queryParams: null,
            columns: [
//                {
//                    title: "车辆编号",
//                    field: 'id',
//                    width:80,
//                    align: 'center',
//                    valign: 'middle'
//                },
                {
                    title: '车牌号',
                    field: 'carno',
                    width:80,
                    align: 'center',
                    valign: 'middle'
                },
                {
                    title: '所属企业',
                    field: 'company',
                    align: 'center',
                    valign: 'middle'
                },

                {
                    title: '运输内容',
                    field: 'content',
                    align: 'center'
                },

                {
                    title: '行驶速度',
                    field: 'speed',
                    width:80,
                    align: 'center'
                },
                {
                    title: '车辆载重',
                    field: 'load',
                    width:80,
                    align: 'center'
                },
                {
                    title: '操作',
                    field: 'load',
                    align: 'center',
                    formatter: function (value, row) {
                        var e = '<a  href="javascript:void(0)" title="" onclick="showCarDetai()">查看详情</a> ';
                        var d = '<a  href="javascript:void(0)" title="" onclick="analiysis(\'' + row.id + '\')">车辆定位</a> ';
                        return e + d;
                    }
                }

            ]
        });
        $('#table1').bootstrapTable({
            method: "get",
            striped: true,
            singleSelect: false,
            url: "json/note1.json",
            dataType: "json",
            pagination: true, //分页
            pageSize: number,
            pageNumber: 1,
            search: false, //显示搜索框
            contentType: "application/x-www-form-urlencoded",
            queryParams: null,
            columns: [
                {
                    title: "威胁源",
                    field: 'id',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    title: '辐射距离',
                    field: 'title',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    title: '威胁范围',
                    field: 'type',
                    align: 'center',
                    valign: 'middle'
                },

                {
                    title: '危害类型',
                    field: 'person',
                    align: 'center'
                }

            ]
        });
        $('#table2').bootstrapTable({
            method: "get",
            striped: true,
            singleSelect: false,
            url: "json/note2.json",
            dataType: "json",
            pagination: true, //分页
            pageSize: number,
            pageNumber: 1,
            search: false, //显示搜索框
            contentType: "application/x-www-form-urlencoded",
            queryParams: null,
            columns: [
                {
                    title: "威胁源",
                    field: 'id',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    title: '辐射距离',
                    field: 'title',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    title: '威胁范围',
                    field: 'type',
                    align: 'center',
                    valign: 'middle'
                },

                {
                    title: '危害类型',
                    field: 'person',
                    align: 'center'
                }

            ]
        });
    }

    function Echarts() {
        var myChart = echarts.init($("#container_huan")[0]);
        var option = {
            tooltip: {
                trigger: 'item',
                formatter: "{a} <br/>{b}: {c} ({d}%)"
            },
            legend: {
                orient: 'vertical',
                x: 'left',
                data:['民用爆炸','射钉器材','危化品','寄递物流','旅店'],
                textStyle:{
                    color:"#e9ebee"
                }
            },
            series: [
                {
                    name:'行业数据',
                    type:'pie',
                    center:['80%','50%'],
                    radius: ['50%', '80%'],
                    avoidLabelOverlap: false,
                    label: {
                        normal: {
                            show: false,
                            position: 'center'
                        },
                        emphasis: {
                            show: true,
                            textStyle: {
                                fontSize: '30',
                                fontWeight: 'bold'
                            }
                        }
                    },
                    itemStyle: {
                        normal: {
                            label: {
                                show: false
                            },
                            labelLine: {
                                show: false
                            }
                        }
                    },
                    data:[
                        {value:335, name:'民用爆炸'},
                        {value:310, name:'射钉器材'},
                        {value:234, name:'危化品'},
                        {value:135, name:'寄递物流'},
                        {value:1548, name:'旅店'}
                    ]
                }
            ]
        };
        myChart.setOption(option);
    }


    function TimeControl(){
        $(".message_scroll_box").animate({marginTop:96},800,
            function(){
                $(".message_scroll_box").css({marginTop:0});    //把顶部的边界清零
                $(".message_scroll_box .message_scroll:first").before($(".message_scroll_box .message_scroll:last"));    //在第一个新闻后面插入最后一个新闻

            });
    }
    var T=setInterval(TimeControl,2300);    //开始定时
    $(".message_scroll_box").mouseenter(function(){
        clearInterval(T);    //停止定时
    })
        .mouseleave(function(){
            T=setInterval(TimeControl,2500);    //再次定时
        })

</script>


<!--轨迹回放时间日期选择-->
<script th:inline="javascript">
    var startTime = {
        elem: '#startTime',
        format: 'YYYY-MM-DD',
        min: '2018-01-01',//'2018-10-09', //设定最小日期为当前日期
//        max: laydate.now(), //最大日期
        istime: true,
        istoday: true,
        fixed: false,
        choose: function (datas) {
            startV = datas;
            changeTime();
        }
    }

    laydate(startTime);

    laydate.skin('danlan');//切换皮肤，请查看skins下面皮肤库
    laydate({elem: '#demo'});
    laydate({elem: '#demo1'});//绑定元素

    !function(){

    }();
    //日期范围限制
    var start = {
        elem: '#start',
        format: 'YYYY-MM-DD',
        min: laydate.now(), //设定最小日期为当前日期
        max: '2099-06-16', //最大日期
        istime: true,
        istoday: false,
        choose: function(datas){
            end.min = datas; //开始日选好后，重置结束日的最小日期
            end.start = datas //将结束日的初始值设定为开始日
        }
    };

    var end = {
        elem: '#end',
        format: 'YYYY-MM-DD',
        min: laydate.now(),
        max: '2099-06-16',
        istime: true,
        istoday: false,
        choose: function(datas){
            start.max = datas; //结束日选好后，充值开始日的最大日期
        }
    };

</script>


 <script th:inline="javascript">
    function initcurve(obj1,obj2){
        var myChart = echarts.init($("#allAly03")[0]);
        option = {
            title : {
                text: '化验曲线',
                textStyle:{
                    color:"#e9ebee"

                },
                x:'center'

            },
            tooltip : {
                trigger: 'axis'
            },
            grid: {
                x: 20,
                y:30,
                x2:30,
                y2:40,
                borderWidth: 0
            },

            calculable : false,
            xAxis : [
                {
                    type : 'category',
                    splitLine:{show: false},
                    axisLabel : {
                        formatter: '{value} ',
                        textStyle: {
                            color: '#a4a7ab',
                            align: 'right'
                        }
                    },
                    data : obj1
                }
            ],
            yAxis : [
                {
                    type : 'value',
                    splitLine:{show: false},
                    axisLabel : {
                        formatter: '{value} ',
                        textStyle: {
                            color: '#a4a7ab',
                            align: 'right'
                        }
                    }
                }
            ],
            grid:{
                borderWidth:0
            },
            series : [
                {
                    name:'化验指数',
                    type:'line',
                    data:obj2,
                    itemStyle: {
                        normal: {
                            color: '#2481ff'
                        }
                    },
                    markPoint : {
                        data : [
                            {type : 'max', name: '最大值'},
                            {type : 'min', name: '最小值'}
                        ]
                    },
                    markLine : {
                        data : [
                            {type : 'average', name: '平均值'}
                        ]
                    }
                }
            ]
        };


        myChart.setOption(option);
    }

</script>

<script th:inline="javascript">
    function inityaoji(obj1,obj2,obj3){
        var myChart = echarts.init($("#bookBmonth")[0]);
        option = {
            tooltip: {   //提示框，鼠标悬浮交互时的信息提示
                show: true,
                trigger: 'axis'
            },
            grid: {
                x: 46,
                y:30,
                x2:30,
                y2:40,
                borderWidth: 0
            },
            calculable: false,
            xAxis: [
                {
                    type: 'category',
                    data : obj1,
                    splitLine: {
                        show: false
                    },
                    axisLabel: {
                        show: true,
                        textStyle: {
                            color: '#a4a7ab',
                            align: 'center'
                        }
                    }
                }

            ],
            yAxis: [
                {
                    type: 'value',
                    splitLine: {
                        show: false
                    },
                    axisLabel : {
                        formatter: '{value} ',
                        textStyle: {
                            color: '#a4a7ab',
                            align: 'right'
                        }
                    },
                    splitLine: {
                        show: false
                    },
                }
            ],
            series: [
                {
                    name: '化验药剂',
                    type: 'bar',
                    data:obj2,
                    barWidth:20,
                    itemStyle: {
                        normal: {
                            color: function(params) {
                                var colorList = ['#11C3FF','#E98F6F','#FFD739','#E79E0B'];
                                return colorList[params.dataIndex];
                            }
                        },
                    }
                },
                {
                    name: '当月均值',
                    type: 'bar',
                    data:obj3,//[randomNum(900,1200),randomNum(700,1100),randomNum(1100,1300),randomNum(500,1200)],
                    barWidth:20,
                    itemStyle: {
                        normal: {
                            color: function(params) {
                                var colorList = ['#58D5FF','#EFB09A','#FFE374','#EEBB54'];
                                return colorList[params.dataIndex];
                            }
                        },
                    }
                },
            ]
        };

        myChart.setOption(option);
    }



</script>

<script th:inline="javascript">
    function initfeiye(obj1,obj2){
        var myChart = echarts.init($("#whearAbook")[0]);
        option = {
            tooltip : {
                trigger: 'axis'
            },
            grid: {
                x: 46,
                y:30,
                x2:30,
                y2:40,
                borderWidth: 0
            },

            calculable : false,
            xAxis : [
                {
                    type : 'category',
                    data : obj1,
                    splitLine: {
                        show: false
                    },
                    axisLabel: {
                        show: true,
                        textStyle: {
                            color: '#a4a7ab',
                            align: 'center'
                        }
                    }

                }
            ],
            yAxis : [
                {
                    type : 'value',
                    axisLabel : {
                        formatter: '{value} ',
                        textStyle: {
                            color: '#a4a7ab',
                            align: 'right'
                        }
                    },
                    splitLine: {
                        show: false
                    },
                },

            ],
            series : [
                {
                    name:'废液',
                    type:'bar',
                    data:obj2,
                    barWidth:20,
                    itemStyle: {
                        normal: {
                            color: function(params) {
                                var colorList = ['#F8D042','#F3A541','#C66401'];
                                return colorList[params.dataIndex];
                            }
                        }
                    }
                }
            ]
        };

        myChart.setOption(option);
    }


    function initleiji(obj1,obj2){
        var myChart = echarts.init($("#actionBook")[0]);
        option = {
            tooltip : {
                trigger: 'axis'
            },
            grid: {
                x: 46,
                y:30,
                x2:30,
                y2:40,
                borderWidth: 0
            },

            calculable : false,

            xAxis : [
                {
                    type : 'category',
                    data : obj1,
                    splitLine: {
                        show: false
                    },
                    axisLabel: {
                        show: true,
                        textStyle: {
                            color: '#a4a7ab',
                            align: 'center'
                        }
                    }

                }
            ],
            yAxis : [
                {
                    type : 'value',
                    axisLabel : {
                        formatter: '{value} ',
                        textStyle: {
                            color: '#a4a7ab',
                            align: 'right'
                        }
                    },
                    splitLine: {
                        show: false
                    },
                },

            ],
            series : [{
                name:'设备累计使用',
                type:'bar',
                roseType : 'area',
                x: '50%',               // for funnel
                max: 40,                // for funnel
                sort : 'ascending',     // for funnel
                data:obj2,
                itemStyle: {
                    normal: {
                        color:"#02bcbc"
                    }
                }
            }]
        };

        myChart.setOption(option);
    }


</script>




<script th:inline="javascript">

    function chage_curve(){
        var curveValue = $("#curveValue").val();
//        var obj = QXList[curveValue];
        if(curveValue==0){
            $("#curve_table").css('display','none');
        }else if(curveValue==1){
            $("#wave1_name").html("入水COD波长1");
            $("#wave2_name").html("入水COD波长2");
            $("#k_name").html("入水COD曲线k");
            $("#b_name").html("入水COD曲线B");

            $("#wave1").html(in_cod_wave1[0]);
            $("#wave2").html(in_cod_wave2[0]);
            $("#curve_k").html(in_cod_k[0]);
            $("#curve_b").html(in_cod_b[0]);

//            initcurve(in_cod_k,in_cod_b,out_cod_k,out_cod_b);
            $("#curve_table").css('display','');
        }else if(curveValue==2){
            $("#wave1_name").html("出水COD波长1");
            $("#wave2_name").html("出水COD波长2");
            $("#k_name").html("出水COD曲线k");
            $("#b_name").html("出水COD曲线B");

            $("#wave1").html(out_cod_wave1[0]);
            $("#wave2").html(out_cod_wave2[0]);
            $("#curve_k").html(out_cod_k[0]);
            $("#curve_b").html(out_cod_b[0]);

            $("#curve_table").css('display','');
        }else if(curveValue==3){
            $("#wave1_name").html("氨氮波长1");
            $("#wave2_name").html("氨氮波长2");
            $("#k_name").html("氨氮曲线k");
            $("#b_name").html("氨氮曲线B");

            $("#wave1").html(nh_wave1[0]);
            $("#wave2").html(nh_wave2[0]);
            $("#curve_k").html(nh_k[0]);
            $("#curve_b").html(nh_b[0]);

            $("#curve_table").css('display','');
        }else if(curveValue==4){
            $("#wave1_name").html("总磷波长1");
            $("#wave2_name").html("总磷波长2");
            $("#k_name").html("总磷曲线k");
            $("#b_name").html("总磷曲线B");

            $("#wave1").html(tp_wave1[0]);
            $("#wave2").html(tp_wave2[0]);
            $("#curve_k").html(tp_k[0]);
            $("#curve_b").html(tp_b[0]);

            $("#curve_table").css('display','');
        }else if(curveValue==5){
            $("#wave1_name").html("总氮波长1");
            $("#wave2_name").html("总氮波长2");
            $("#k_name").html("总氮曲线k");
            $("#b_name").html("总氮曲线B");

            $("#wave1").html(tn_wave1[0]);
            $("#wave2").html(tn_wave2[0]);
            $("#curve_k").html(tn_k[0]);
            $("#curve_b").html(tn_b[0]);

            $("#curve_table").css('display','');
        }
    }


    var ctx = [[@{/}]];

    function changeTime(){
        date_sign=0;
        select_tip =0;
        $("#NoValue_span").css('display','none');
        $("#NoValue").css('display','none');
        $("#btn_sw").css('display','none');
        $("#btn_sn").css('display','');
    }

    function changewaterid(){
        date_sign=0;
        select_tip =0;
        $("#NoValue_span").css('display','none');
        $("#NoValue").css('display','none');
        $("#btn_sw").css('display','none');
        $("#btn_sn").css('display','');
    }


    function select_no(){

        var waterValue = $("#waterValue").val();
        var timeValue = $("#startTime").val();
        if(waterValue == ""){
            alert("请选择化验现场");
            return false;
        }
        if(timeValue == ""){
            alert("请选择化验日期");
            return false;
        }

        var d = {};
        d.waterValue = waterValue;
        d.timeValue = timeValue;

        $.ajax({
            url: ctx + "index/getAssayByWorkTime",
            data: JSON.stringify(d),
            type: "POST",
            cache: false,
            contentType: "application/json;charset=utf-8",
            processData: false,
//            dataType: 'json',
            success: function(result) {
                var obj = eval('('+result.assayData+')');
                var assayData =obj.assayData;
                if(assayData !=''&& assayData != null&& assayData !== 'undefined'){

                    $("#NoValue").empty();
                    $("#NoValue").append("<option class=\"water_option\" value=\"\">请选择</option>");
                    for (var p in assayData) {
                        $("#NoValue").append("<option class=\"water_option\" value=\""+assayData[p]+"\">"+assayData[p]+"</option>");
                    }
                    $("#NoValue_span").css('display','');
                    $("#NoValue").css('display','');
                    $("#btn_sw").css('display','');
                    $("#btn_sn").css('display','none');
                }else{
                    alert("日期: "+timeValue+" 无化验数据");
                }
            },
            error: function(error) {
                alert("日期: "+timeValue+" 无化验数据");
            }
        })

    }

    var curvedate=[];

    var in_cod_wave1=[];
    var in_cod_wave2=[];
    var in_cod_k=[];
    var in_cod_b=[];

    var out_cod_wave1=[];
    var out_cod_wave2=[];
    var out_cod_k=[];
    var out_cod_b=[];

    var tp_wave1=[];
    var tp_wave2=[];
    var tp_k=[];
    var tp_b=[];

    var tn_wave1=[];
    var tn_wave2=[];
    var tn_k=[];
    var tn_b=[];

    var nh_wave1=[];
    var nh_wave2=[];
    var nh_k=[];
    var nh_b=[];

    //循环标记
    var select_tip =0;
    //判断是否当日标记
    var date_sign=0;

    function chage_water(){
        var waterValue = $("#waterValue").val();
        var timeValue = $("#startTime").val();
        var NoValue = $("#NoValue").val();

        if(waterValue == ""){
            alert("请选择化验现场");
            return false;
        }
        if(timeValue == ""){
            alert("请选择化验日期");
            return false;
        }
        if(NoValue == ""){
            alert("请选择化验编号");
            return false;
        }

        getAgentiaTotal(NoValue,waterValue,timeValue);
        getWasteTotal(NoValue,waterValue,timeValue);
        getUnitNum(waterValue);

        getAssayAll(NoValue);
    }

    function getAssayAll(NoValue){
        var d = {};
        d.NoValue = NoValue;

        $.ajax({
            url: ctx + "index/getAssayByNo",
            data: JSON.stringify(d),
            type: "POST",
            cache: false,
            contentType: "application/json;charset=utf-8",
            processData: false,
//            dataType: 'json',
            success: function(result) {

                select_tip = 1;

                var assayData = eval('('+result.assayData+')');
                var nodeData = eval('('+result.nodeData+')');
                var curveData = eval('('+result.curveData+')');

                var datesign = result.datesign;
                if(datesign !=''&& datesign != null&& datesign !== 'undefined'){
                    date_sign = datesign;
                }


                $("#val01").html(NoValue);
                if(assayData !=''&& assayData != null&& assayData !== 'undefined'){
                    $("#tval05").html(assayData.in_cod);
                    $("#tval06").html(assayData.in_nh);
                    $("#tval07").html(assayData.in_tp);
                    $("#tval08").html(assayData.in_tn);
                    $("#tval09").html(assayData.out_cod);
                    $("#tval10").html(assayData.out_nh);
                    $("#tval11").html(assayData.out_tp);
                    $("#tval12").html(assayData.out_tn);
                }else{
                    alert("化验编号: "+NoValue+" 无具体数据");
                }

                if(nodeData !=''&& nodeData != null&& nodeData !== 'undefined'){
                    $("#val02").html(nodeData.devicename);
                    $("#val03").html(nodeData.repairBy);
                    $("#valrt_1").html(nodeData.node);
                    $("#valrt_2").html("大流程"+nodeData.bigprocess);
                    $("#valrt_3").html(nodeData.smallprocess+" 化验步骤");
                    $("#valrt_4").html("无告警");
                    $("#valrt_5").html(nodeData.fault);
                    if(nodeData.fault=='有故障'){
                        $("#valrt_5").attr("class","font05");
                    }else{
                        $("#valrt_5").attr("class","font04");
                    }

                    var alertCon=nodeData.alertCon;
                    if(alertCon !=''&& alertCon != null&& alertCon !== 'undefined'){

                        var alertStr = alertCon.split(";");
                        var psCon ="";
                        $("#p2").html("");
                        $.each(alertStr, function(i,val){
                            if(val!=''){
//                            alert(val);
                                $("#p2").append("<li>&nbsp&nbsp&nbsp&nbsp <a style='color:#E92B23;'>"+val+"&nbsp  </a></li>");
                            }
                        });

                    }else{
                        $("#p2").html("");
                    }

                }
                else{
                    alert("化验编号: "+NoValue+" 无节点数据");
                }

                if(curveData !=''&& curveData != null&& curveData !== 'undefined'){
                    curvedate = curveData.curvedate;
                    in_cod_wave1 = curveData.in_cod_wave1;
                    in_cod_wave2 = curveData.in_cod_wave2;
                    in_cod_k = curveData.in_cod_k;
                    in_cod_b = curveData.in_cod_b;

                    out_cod_wave1 = curveData.out_cod_wave1;
                    out_cod_wave2 = curveData.out_cod_wave2;
                    out_cod_k = curveData.out_cod_k;
                    out_cod_b = curveData.out_cod_b;

                    tp_wave1 = curveData.tp_wave1;
                    tp_wave2 = curveData.tp_wave2;
                    tp_k = curveData.tp_k;
                    tp_b = curveData.tp_b;

                    tn_wave1 = curveData.tn_wave1;
                    tn_wave2 = curveData.tn_wave2;
                    tn_k = curveData.tn_k;
                    tn_b = curveData.tn_b;

                    nh_wave1 = curveData.nh_wave1;
                    nh_wave2 = curveData.nh_wave2;
                    nh_k = curveData.nh_k;
                    nh_b = curveData.nh_b;

                    chage_curve();
//                    $("#curveValue").val("0");
//                    $("#curve_table").css('display','none');
//                    $("#allAly03").html("");
                }else{
                    alert("化验编号: "+NoValue+" 无化验曲线");
                }
//                yingXiao();
            },
            error: function(error) {
                alert("化验编号: "+NoValue+" 无化验数据");
            }
        })
    }
    
    function relieve_alert() {
        var waterValue = $("#waterValue").val();
        var timeValue = $("#startTime").val();
        var NoValue = $("#NoValue").val();
        if(waterValue != ""&&timeValue != ""&&NoValue != ""&&select_tip==1){
            var d = {};
            d.NoValue = NoValue;

            $.ajax({
                url: ctx + "index/relieveAlert",
                data: JSON.stringify(d),
                type: "POST",
                cache: false,
                contentType: "application/json;charset=utf-8",
                processData: false,
//            dataType: 'json',
                success: function(result) {
                    chage_water();
                },
                error: function(error) {
                    alert("解除故障告警失败");
                }
            })
        }
    }

        //    定时刷新首页项目列表 30s
        setInterval(function(){
            var waterValue = $("#waterValue").val();
            var timeValue = $("#startTime").val();
            var NoValue = $("#NoValue").val();
            if(waterValue != ""&&timeValue != ""&&NoValue != ""&&select_tip==1&&date_sign==1){
                chage_water();
            }else{
                fresh_index();
            }
        }, 30000);

        var $this = $(".scrollNews");
        var scrollTimer;
        $this.hover(function () {
            clearInterval(scrollTimer);
        }, function () {
            scrollTimer = setInterval(function () {
                scrollNews($this);
            }, 5000);
        }).trigger("mouseleave");
        function scrollNews(obj) {
            var $self = obj.find("ul");
            var lineHeight = $self.find("li:first").height();
            $self.animate({
                "marginTop": -lineHeight + "px"
            }, 500, function () {
                $self.css({
                    marginTop: 0
                }).find("li:first").appendTo($self);
            })
        }

    function getAgentiaTotal(NoValue,waterValue,timeValue){
        var d = {};
        d.waterValue = waterValue;
        d.NoValue = NoValue;
        d.timeValue = timeValue;
        $.ajax({
            url: ctx + "index/getAgentiaTotal",
            data: JSON.stringify(d),
            type: "POST",
            cache: false,
            contentType: "application/json;charset=utf-8",
            processData: false,
//            dataType: 'json',
            success: function(result) {
                var agentiaTotal = eval('('+result.agentiaTotal+')');
                if(agentiaTotal !=''&& agentiaTotal != null&& agentiaTotal !== 'undefined'){
                    var agentia = agentiaTotal.agentia;
                    var total = agentiaTotal.total;
                    var avg = agentiaTotal.avg;
                    inityaoji(agentia,total,avg);
                }
            },
            error: function(error) {
                alert("化验编号: "+NoValue+" 无药剂对比数据");
            }
        })
    }

    function   getWasteTotal(NoValue,waterValue,timeValue){
        var d = {};
        d.waterValue = waterValue;
        d.NoValue = NoValue;
        d.timeValue = timeValue;
        $.ajax({
            url: ctx + "index/getWasteTotal",
            data: JSON.stringify(d),
            type: "POST",
            cache: false,
            contentType: "application/json;charset=utf-8",
            processData: false,
//            dataType: 'json',
            success: function(result) {
                var wasteTotal = eval('('+result.wasteTotal+')');
                if(wasteTotal !=''&& wasteTotal != null&& wasteTotal !== 'undefined'){
                    var wasteName = wasteTotal.wasteName;
                    var wasteValue = wasteTotal.wasteValue;
                    initfeiye(wasteName,wasteValue);
                }
            },
            error: function(error) {
                alert("化验编号: "+NoValue+" 无废液数据");
            }
        })
    }

        function   getUnitNum(waterValue){
            var d = {};
            d.waterValue = waterValue;
            $.ajax({
                url: ctx + "index/getUnitNum",
                data: JSON.stringify(d),
                type: "POST",
                cache: false,
                contentType: "application/json;charset=utf-8",
                processData: false,
//            dataType: 'json',
                success: function(result) {
                    var unitTotal = eval('('+result.unitTotal+')');
                    if(unitTotal !=''&& unitTotal != null&& unitTotal !== 'undefined'){
                        var unitName = unitTotal.unitName;
                        var unitNum = unitTotal.unitNum;
                        initleiji(unitName,unitNum);
                    }
                },
                error: function(error) {
                    alert("化验编号: "+NoValue+" 无废液数据");
                }
            })
        }

        function fresh_index(){
            var d = {};
            d.freshIndex = "freshIndex";
            $.ajax({
                url: ctx + "index/freshIndex",
                data: JSON.stringify(d),
                type: "POST",
                cache: false,
                contentType: "application/json;charset=utf-8",
                processData: false,
//            dataType: 'json',
                success: function(result) {
                },
                error: function(error) {
                }
            })

        }

    function click2(){
        history.back(-1);
    }

    //计算天数差的函数，通用
    function  DateDiff(sDate1,  sDate2){    //sDate1和sDate2是2002-12-18格式
        var  aDate,  oDate1,  oDate2,  iDays
        aDate  =  sDate1.split("-")
        oDate1  =  new  Date(aDate[1]  +  '-'  +  aDate[2]  +  '-'  +  aDate[0])    //转换为12-18-2002格式
        aDate  =  sDate2.split("-")
        oDate2  =  new  Date(aDate[1]  +  '-'  +  aDate[2]  +  '-'  +  aDate[0])
        iDays  =  parseInt(Math.abs(oDate1  -  oDate2)  /  1000  /  60  /  60  /24)    //把相差的毫秒数转换为天数
        return  iDays
    }

</script>

</body>
</html>
